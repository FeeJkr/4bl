{% extends 'invoices/dashboard.html.twig' %}

{% block submodules %}
    <div class="mt-5">
        <form method="POST" action="{{ path('invoices.invoice.generate') }}">
            <div class="d-grid gap-2 col-6 mx-auto">
                <div class="mb-1">
                    <div class="d-grid">
                        <div class="input-group">
                            <div class="input-group">
                                <span class="input-group-text col-5">Invoice number:</span>
                                <input type="text" aria-label="Invoice number" name="invoiceNumber" class="form-control col-7" id="invoiceNumberTextField">
                                <button class="btn btn-outline-secondary" type="button" id="setThisMonthInvoiceNumber">This month</button>
                                <button class="btn btn-outline-secondary" type="button" id="setPrevMonthInvoiceNumber">Prev month</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Generate date:</span>
                            <input type="date" aria-label="Generate date" name="generateDate" class="form-control col-7">
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Sell date:</span>
                            <input type="date" aria-label="Sell date" name="sellDate" class="form-control col-7">
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Generate place:</span>
                            <input type="text" aria-label="Generate place" name="generatePlace" class="form-control col-7">
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Seller:</span>
                            <select class="form-select" aria-label="Seller" name="sellerId">
                                <option selected>Please, choose seller</option>
                                {% for company in companies %}
                                    <option value="{{ company.id }}">{{ company.name }} ({{ company.identificationNumber }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Buyer:</span>
                            <select class="form-select" aria-label="Buyer" name="buyerId">
                                <option selected>Please, choose buyer</option>
                                {% for company in companies %}
                                    <option value="{{ company.id }}">{{ company.name }} ({{ company.identificationNumber }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Already taken price:</span>
                            <input type="number" step="0.01" aria-label="Already taken price" name="alreadyTakenPrice" class="form-control col-7" value="0.00">
                        </div>
                        <div class="input-group">
                            <span class="input-group-text col-5">Currency code:</span>
                            <input type="text" aria-label="Currency code" name="currencyCode" class="form-control col-7" value="PLN">
                        </div>

                        <div class="input-group" style="text-align: center;">
                            <span class="input-group-text col-10" style="display: block;">Products</span>
                            <button class="btn btn-outline-success col-2" type="button" id="addProductButton">Add</button>
                        </div>

                        <hr/>
                        <div id="productsBox">

                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-success">Generate</button>
            </div>
        </form>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        $(document).ready(function () {
            let invoiceNumberTextField = $('#invoiceNumberTextField');
            let productIndex = 0;

            $('#setThisMonthInvoiceNumber').on('click', function () {
                const today = new Date();

                invoiceNumberTextField.val(
                    `1/${today.getMonth()+1}/${today.getFullYear()}`
                );
            });

            $('#setPrevMonthInvoiceNumber').on('click', function () {
                const today = (new Date());
                today.setMonth(today.getMonth() - 1);

                invoiceNumberTextField.val(
                    `1/${today.getMonth()+1}/${today.getFullYear()}`
                );
            });

            $('#addProductButton').on('click', function () {
                productIndex++;

                $('#productsBox').append(`
                    <div style="margin-top: 5px;" class="product" id="product-${productIndex}">
                        <div class="row g-2">
                            <div class="col-5" style="text-align: center;">
                                <input type="text" class="form-control" id="productName" name="products[${productIndex}][name]" placeholder="Product name">
                            </div>
                            <div class="col-5" style="text-align: center; margin-bottom: 10px;">
                                <input type="number" step="0.01" class="form-control" id="productPrice" name="products[${productIndex}][netPrice]" placeholder="Product net price">
                            </div>
                            <div class="col-2" style="text-align: center; margin-bottom: 10px; ">
                                <input type="button" class="btn btn-danger remove-button" value="X" data-index="${productIndex}">
                            </div>
                        </div>
                    </div>
                `);
            });

            $('body').on('click', '.remove-button', function () {
                $('#product-' + $(this).data('index')).remove();
            });
        });
    </script>
{% endblock %}